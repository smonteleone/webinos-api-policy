
<html>
<script>

var matches = {
    "subject-match" : 
        [   {"$" : {"attr" : "api-feature", "match" : "http://webinos.org/api/nfc"}} 
            ,
            {"$" : {"attr" : "api-feature", "match" : "http://webinos.org/api/sensor"}}
        ]
 };
 var matches2 = {
    "subject-match" : 
        [   {"$" : {"attr" : "api-feature", "match" : "http://webinos.org/api/location"}} 
        ]
 };

var condition = 
    {
        "$":{"id":"cond3", "combine":"or"},
        "resource-match":[
            {"$":{"attr":"api-feature", "match":"minnie"}},
            {"$":{"attr":"api-feature", "match":"topolino"}}
        ]
    };

var condition2 = 
    {
        "$":{"id":"cond3", "combine":"and"},
        "resource-match":[
            {"$":{"attr":"api-feature", "match":"nonno"}},
            {"$":{"attr":"api-feature", "match":"nanni"}}
        ]
    };


var policyeditor;

function start(){
    //alert(webinos);
    webinos.discovery.findServices(new ServiceType('http://webinos.org/core/policymanagement'), 
        {onFound: function (service){ 
            //alert(1);
            policyeditor =  service;
            policyeditor.bindService({onBind: function (service) {
                //alert(2);
                var ps = policyeditor.getPolicySet(0, function(ps){
                    //alert(3);
                    var pol;
                    //TEST1
                    /*
                    alert("Test1: get a policy, add a rule, update the rule")
                    var pol = ps.getPolicy("p2");
                    alert("Policy : "+pol.toJSONString());
                    pol.addRule("rule 3", "permit", condition2);
                    alert(ps.toJSONString());
                    pol.updateRule("rule 3","deny", condition);
                    alert(ps.toJSONString());  
                    */

                    //TEST2                  
                    /*
                    alert("Test2 : add two policies with same id");
                    var p10 = ps.createPolicy("same_id","permit-overrides","descr p10");
                    ps.addPolicy(p10);
                    alert(ps.toJSONString());
                    var p11 = ps.createPolicy("same_id","permit-overrides","descr p11");
                    ps.addPolicy(p11);
                    alert(ps.toJSONString());
                    */

                    //TEST3 test policy.addsubject
                    
                    alert("Test3 : getPolicy, add subject, remove subject and add subject");
                    pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.removeSubject("sub1");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    
                    //TEST 4 test policy.removeRule
                    /*
                    pol = ps.getPolicy("p2");
                    pol.addRule("rule 3", "permit", condition2);
                    alert(pol.toJSONString());
                    pol.addRule("rule 4", "deny", condition);
                    alert(pol.toJSONString());
                    pol.removeRule("rule 3");
                    alert(pol.toJSONString());
                    pol.removeRule("rule 4");
                    alert(pol.toJSONString());
                    pol.addRule("rule 4", "deny", condition);
                    alert(pol.toJSONString());
                    */
                    //TEST 5 test policy.updateRule
                    /*
                    pol = ps.getPolicy("p2");
                    pol.addRule("rule 3", "permit");
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "effect", "permit-overrides");
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "condition", condition);
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "condition", condition2);
                    alert(pol.toJSONString());
                    pol.updateRule("rule 3", "condition");
                    alert(pol.toJSONString());
                    */
                    //TEST 6
                    /*
                    alert("Test6 : Add subject, than add subject with same id");
                    pol = ps.getPolicy("p2");
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches);
                    alert(pol.toJSONString());
                    pol.addSubject("sub1", matches2);
                    alert(pol.toJSONString());
                    */
                    // TEST 7 test policyset.updateAttributes
                    /*
                    ps.addPolicySet("ps1", "deny-overrides", "description", 0);
                    var policyset = ps.getPolicySet("ps1");
                    alert(ps.toJSONString());
                    policyset.updateAttributes("combine", "permit-overrides");
                    alert(ps.toJSONString());
                    policyset.updateAttributes("description", "new description");
                    alert(ps.toJSONString());
                    */
                }, null);
            }});
        }
    });
}



</script>

<body>
 <button onClick="start()">Start</button>
 </body>   
</html>